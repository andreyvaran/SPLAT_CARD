import numpy as np

import os

import json

home = os.getcwd()

main_cnfg_pth = "main_config.json"

conf_dict = {
    "test_zones": ["zone_1", "zone_2", "zone_3", "zone_4", "zone_5"],
    "classes": [
        "cal_1",
        "cal_10",
        "cal_11",
        "cal_12",
        "cal_13",
        "cal_14",
        "cal_15",
        "cal_16",
        "cal_17",
        "cal_18",
        "cal_19",
        "cal_2",
        "cal_20",
        "cal_21",
        "cal_22",
        "cal_23",
        "cal_24",
        "cal_3",
        "cal_4",
        "cal_5",
        "cal_6",
        "cal_7",
        "cal_8",
        "cal_9",
        "zone_1",
        "zone_2",
        "zone_3",
        "zone_4",
        "zone_5",
        "eval_1",
        "eval_10",
        "eval_11",
        "eval_12",
        "eval_2",
        "eval_3",
        "eval_4",
        "eval_5",
        "eval_6",
        "eval_7",
        "eval_8",
        "eval_9",
        "tooth_1",
        "tooth_2",
        "tooth_3",
        "tooth_4",
    ],
    "config_path": os.path.join(home, "custom_pilot.py"),
    "weights_path": os.path.join(home, "epoch_2500.pth"),
    "shadow_1": [["cal_1", "cal_13", "eval_1", "eval_7"], [16.91, 17.97]],
    "shadow_2": [
        ["eval_1", "eval_2", "eval_7", "eval_8", "cal_2", "cal_14"],
        [16.91, 35.01],
    ],
    "shadow_3": [
        ["eval_2", "eval_3", "eval_8", "eval_9", "cal_3", "cal_15"],
        [16.91, 52.02],
    ],
    "shadow_4": [
        ["eval_3", "eval_4", "eval_9", "eval_10", "cal_4", "cal_16"],
        [16.91, 69.09],
    ],
    "shadow_5": [
        ["eval_4", "eval_5", "eval_10", "eval_11", "cal_5", "cal_17"],
        [16.91, 86.13],
    ],
    "shadow_6": [
        ["eval_5", "eval_6", "eval_11", "eval_12", "cal_6", "cal_18"],
        [16.91, 103.17],
    ],
    "shadow_7": [
        ["eval_6", "eval_12", "cal_8", "cal_20", "cal_7", "cal_19"],
        [16.91, 120.21],
    ],
    "shadow_8": [
        ["cal_21", "cal_9", "cal_10", "cal_22", "cal_8", "cal_20"],
        [16.91, 137.25],
    ],
    "shadow_9": [
        ["cal_10", "cal_11", "cal_12", "cal_22", "cal_23", "cal_24"],
        [16.91, 154.29],
    ],
    "shadow_10": [["cal_1", "cal_13", "eval_1", "eval_7"], [43.09, 17.97]],
    "shadow_11": [
        ["eval_1", "eval_2", "eval_7", "eval_8", "cal_2", "cal_14"],
        [43.09, 35.01],
    ],
    "shadow_12": [
        ["eval_2", "eval_3", "eval_8", "eval_9", "cal_3", "cal_15"],
        [43.09, 52.02],
    ],
    "shadow_13": [
        ["eval_3", "eval_4", "eval_9", "eval_10", "cal_4", "cal_16"],
        [43.09, 69.09],
    ],
    "shadow_14": [
        ["eval_4", "eval_5", "eval_10", "eval_11", "cal_5", "cal_17"],
        [43.09, 86.13],
    ],
    "shadow_15": [
        ["eval_5", "eval_6", "eval_11", "eval_12", "cal_6", "cal_18"],
        [43.09, 103.17],
    ],
    "shadow_16": [
        ["eval_6", "eval_12", "cal_8", "cal_20", "cal_7", "cal_19"],
        [43.09, 120.21],
    ],
    "shadow_17": [
        ["cal_21", "cal_9", "cal_10", "cal_22", "cal_8", "cal_20"],
        [43.09, 137.25],
    ],
    "shadow_18": [
        ["cal_10", "cal_11", "cal_12", "cal_22", "cal_23", "cal_24"],
        [43.09, 154.29],
    ],
    "tooth_1": [6.5, 6.5],
    "tooth_2": [53.5, 6.5],
    "tooth_3": [6.5, 173.5],
    "tooth_4": [53.5, 173.5],
    "cal_1": [8.57, 17.97],
    "cal_2": [8.57, 35.01],
    "cal_3": [8.57, 52.02],
    "cal_4": [8.57, 69.09],
    "cal_5": [8.57, 86.13],
    "cal_6": [8.57, 103.17],
    "cal_7": [8.57, 120.21],
    "cal_8": [13.49, 128.73],
    "cal_9": [8.57, 137.25],
    "cal_10": [13.49, 145.77],
    "cal_11": [8.57, 154.29],
    "cal_12": [13.49, 162.81],
    "cal_13": [51.43, 17.97],
    "cal_14": [51.43, 35.01],
    "cal_15": [51.43, 52.02],
    "cal_16": [51.43, 69.09],
    "cal_17": [51.43, 86.13],
    "cal_18": [51.43, 103.17],
    "cal_19": [51.43, 120.21],
    "cal_20": [46.51, 128.73],
    "cal_21": [51.43, 137.25],
    "cal_22": [46.51, 145.77],
    "cal_23": [51.43, 154.29],
    "cal_24": [46.51, 162.81],
    "eval_1": [13.49, 26.49],
    "eval_2": [13.49, 43.53],
    "eval_3": [13.49, 60.57],
    "eval_4": [13.49, 77.61],
    "eval_5": [13.49, 94.65],
    "eval_6": [13.49, 111.69],
    "eval_7": [46.51, 26.49],
    "eval_8": [46.51, 43.53],
    "eval_9": [46.51, 60.57],
    "eval_10": [46.51, 77.61],
    "eval_11": [46.51, 94.65],
    "eval_12": [46.51, 111.69],

    'leu': [
        [[196, 193, 164],
         [196, 195, 169],
         [200, 199, 174],
         [198, 197, 174],
         [200, 196, 160],
         [196, 195, 167],
         [196, 195, 167],
         [197, 196, 175],
         [194, 193, 166],
         [198, 196, 163]],

        [[191, 190, 171],
         [190, 188, 168],
         [191, 189, 167],
         [189, 187, 165],
         [191, 191, 172],
         [187, 185, 167],
         [191, 189, 165],
         [194, 192, 172],
         [191, 189, 171],
         [191, 190, 171]],

        [[187, 185, 170],
         [187, 184, 166],
         [188, 184, 162],
         [188, 184, 169],
         [188, 182, 160],
         [185, 181, 168],
         [188, 183, 159],
         [188, 184, 169],
         [188, 181, 147],
         [186, 182, 162]],

        [[181, 175, 160],
         [179, 173, 163],
         [179, 175, 166],
         [184, 175, 146],
         [184, 177, 160],
         [179, 173, 166],
         [183, 176, 166],
         [180, 173, 160],
         [181, 174, 158],
         [183, 177, 164]],

        [[182, 174, 165],
         [181, 171, 168],
         [180, 172, 163],
         [184, 175, 158],
         [179, 170, 165],
         [179, 170, 164],
         [180, 173, 164],
         [183, 177, 162],
         [176, 166, 159],
         [176, 165, 159],
         [176, 167, 148]],

        [[173, 164, 155],
         [175, 167, 166],
         [176, 165, 157],
         [179, 170, 166],
         [177, 169, 164],
         [171, 158, 156],
         [163, 149, 157],
         [165, 153, 157],
         [167, 154, 158],
         [178, 167, 164]],

        [[166, 151, 155],
         [168, 156, 143],
         [166, 153, 157],
         [163, 149, 147],
         [174, 163, 154]],

        [[159, 142, 152],
         [165, 153, 146],
         [171, 159, 153],
         [164, 149, 154],
         [161, 146, 155],
         [159, 142, 154],
         [171, 156, 150],
         [161, 144, 155],
         [158, 142, 152],
         [171, 158, 150]],

        [[155, 140, 143],
         [163, 145, 154],
         [168, 154, 144],
         [158, 142, 148],
         [156, 138, 147],
         [155, 136, 144],
         [151, 131, 140],
         [161, 145, 147],
         [162, 145, 143],
         [159, 143, 147]],

        [[154, 138, 132],
         [139, 116, 136],
         [157, 140, 131],
         [149, 130, 140],
         [150, 131, 143],
         [153, 134, 147],
         [155, 139, 146],
         [149, 127, 142],
         [150, 129, 140],
         [158, 141, 147]],

        [[146, 124, 141],
         [148, 127, 142],
         [145, 124, 141],
         [148, 125, 136],
         [148, 127, 139],
         [146, 126, 138],
         [146, 124, 139],
         [154, 135, 141],
         [150, 128, 139],
         [147, 125, 141]],

        [[139, 112, 128],
         [144, 121, 136],
         [150, 125, 131],
         [147, 124, 141],
         [149, 123, 139],
         [152, 127, 140],
         [151, 127, 141],
         [143, 118, 137],
         [152, 127, 140]],

        [[151, 124, 139],
         [160, 133, 143],
         [152, 125, 138],
         [154, 129, 143],
         [156, 129, 137],
         [160, 139, 141],
         [148, 121, 133],
         [150, 121, 135],
         [150, 120, 135],
         [157, 133, 143]]],

    'ph': [
        [[227, 134, 75],
         [225, 136, 75],
         [225, 132, 77],
         [226, 134, 76],
         [226, 131, 74],
         [226, 135, 78],
         [225, 133, 74],
         [226, 134, 77],
         [224, 131, 76],
         [225, 135, 79]],

        [[228, 147, 73],
         [227, 146, 77],
         [224, 141, 70],
         [225, 141, 73],
         [226, 143, 75],
         [224, 141, 72],
         [224, 143, 74],
         [226, 149, 76],
         [223, 146, 70],
         [227, 149, 72],
         [227, 148, 73],
         [224, 146, 72],
         [224, 145, 71],
         [225, 146, 70]],

        [[225, 159, 71],
         [222, 159, 69],
         [224, 160, 71],
         [224, 157, 65],
         [222, 159, 70],
         [224, 155, 65],
         [222, 155, 67],
         [224, 153, 65],
         [224, 157, 73],
         [226, 157, 66],
         [224, 155, 64],
         [223, 156, 66]],

        [[212, 168, 69],
         [213, 169, 69],
         [213, 169, 67],
         [213, 172, 72],
         [213, 168, 68],
         [214, 170, 69],
         [213, 169, 69],
         [212, 168, 68],
         [215, 168, 68],
         [211, 169, 73],
         [210, 168, 73],
         [213, 170, 70]],

        [[181, 167, 76],
         [180, 168, 76],
         [180, 167, 74],
         [178, 164, 75],
         [182, 169, 77],
         [182, 168, 74],
         [180, 170, 82],
         [178, 166, 77],
         [183, 170, 78],
         [181, 166, 75],
         [182, 169, 76]],

        [[137, 154, 92],
         [132, 154, 92],
         [134, 155, 91],
         [130, 150, 89],
         [134, 154, 96],
         [135, 156, 95],
         [135, 155, 91],
         [132, 152, 89],
         [144, 154, 85],
         [139, 157, 89],
         [132, 152, 87],
         [137, 153, 88],
         [136, 155, 85]],

        [[99, 137, 98],
         [101, 142, 102],
         [100, 138, 98],
         [102, 140, 100],
         [102, 143, 104],
         [103, 143, 102],
         [101, 144, 107],
         [98, 138, 98],
         [100, 143, 103],
         [104, 143, 102],
         [99, 140, 103],
         [99, 141, 103]],

        [[83, 132, 109],
         [88, 137, 112],
         [87, 135, 113],
         [86, 134, 111],
         [86, 133, 109],
         [86, 135, 110],
         [92, 136, 109],
         [89, 132, 105],
         [89, 133, 109],
         [87, 136, 111],
         [88, 135, 109]]],

    'prot': [
        [[164, 142, 151],
         [160, 139, 149],
         [158, 138, 150],
         [166, 143, 153],
         [163, 141, 152],
         [160, 140, 151],
         [158, 138, 150],
         [160, 141, 149],
         [163, 141, 149],
         [157, 136, 144], ],

        [[163, 144, 152],
         [160, 144, 150],
         [158, 142, 150],
         [160, 142, 150],
         [158, 139, 147],
         [160, 144, 151],
         [161, 144, 148],
         [158, 142, 150],
         [159, 143, 151],
         [158, 142, 150],
         [160, 148, 154],
         [159, 146, 151]],

        [[158, 144, 146],
         [157, 139, 146],
         [159, 145, 150],
         [157, 140, 147],
         [162, 147, 151],
         [158, 142, 148],
         [160, 146, 150],
         [158, 141, 148],
         [158, 142, 149],
         [159, 144, 150],
         [160, 145, 151]],

        [[157, 143, 149],
         [157, 142, 147],
         [158, 142, 147],
         [159, 145, 149],
         [161, 147, 150],
         [162, 146, 149],
         [157, 140, 144],
         [157, 141, 144],
         [157, 143, 148],
         [161, 143, 148],
         [157, 140, 146],
         [161, 142, 146]],

        [[161, 148, 151],
         [161, 145, 147],
         [159, 146, 150],
         [160, 146, 148],
         [160, 146, 149],
         [161, 147, 148],
         [159, 145, 148],
         [165, 151, 150],
         [165, 151, 150],
         [162, 149, 149],
         [161, 146, 147],
         [159, 149, 149],
         [159, 147, 148]],

        [[158, 150, 148],
         [162, 150, 149],
         [160, 151, 150],
         [162, 153, 151],
         [162, 153, 150],
         [161, 153, 152],
         [160, 155, 150],
         [157, 146, 145],
         [160, 156, 148],
         [156, 149, 147],
         [163, 158, 154]],

        [[157, 157, 149],
         [157, 153, 147],
         [157, 153, 146],
         [163, 156, 150],
         [158, 155, 149],
         [156, 152, 144],
         [157, 155, 147],
         [161, 161, 149],
         [157, 154, 148],
         [161, 159, 151],
         [156, 155, 149],
         [159, 157, 148]],

        [[155, 160, 146],
         [154, 158, 144],
         [155, 161, 148],
         [154, 157, 144],
         [153, 158, 146],
         [158, 163, 149],
         [154, 158, 146],
         [155, 159, 145],
         [155, 157, 144],
         [159, 165, 151]],

        [[159, 170, 153],
         [156, 164, 149],
         [156, 159, 147],
         [154, 159, 145],
         [155, 161, 146],
         [156, 164, 148],
         [160, 169, 151],
         [156, 165, 149],
         [156, 164, 148],
         [155, 163, 149],
         [157, 164, 148],
         [154, 164, 149]]],

    'den': [
        [[88, 106, 147],
         [84, 103, 143],
         [81, 98, 138],
         [84, 102, 142],
         [82, 100, 142],
         [82, 100, 140],
         [83, 100, 141],
         [82, 96, 134],
         [84, 101, 140],
         [84, 100, 140],
         [80, 94, 133], ],

        [[85, 103, 143],
         [82, 98, 137],
         [84, 99, 138],
         [81, 96, 137],
         [80, 97, 139],
         [79, 96, 136],
         [85, 103, 142],
         [82, 98, 138],
         [85, 102, 142],
         [82, 98, 138],
         [86, 102, 143],
         [84, 101, 140]],

        [[81, 97, 138],
         [89, 106, 146],
         [80, 95, 135],
         [88, 104, 141],
         [81, 96, 135],
         [87, 106, 145],
         [91, 108, 147],
         [92, 106, 141],
         [87, 105, 144],
         [80, 96, 137],
         [80, 95, 135],
         [80, 97, 138]],

        [[89, 104, 144],
         [83, 100, 141],
         [84, 99, 137],
         [81, 96, 136],
         [81, 98, 139],
         [87, 105, 145],
         [90, 105, 146],
         [84, 101, 142],
         [89, 102, 143],
         [84, 98, 138],
         [86, 100, 138],
         [89, 106, 146]],

        [[100, 106, 147],
         [89, 98, 139],
         [93, 103, 140],
         [87, 96, 137],
         [85, 97, 138],
         [85, 97, 139],
         [95, 99, 141],
         [90, 98, 139],
         [96, 102, 145],
         [91, 98, 141],
         [91, 101, 143],
         [91, 102, 142]],

        [[93, 87, 129],
         [97, 87, 131],
         [96, 85, 129],
         [93, 92, 137],
         [95, 90, 135],
         [96, 91, 133],
         [111, 92, 138],
         [106, 96, 142],
         [100, 89, 136],
         [104, 87, 132],
         [98, 87, 131],
         [97, 91, 136]],

        [[109, 85, 130],
         [112, 89, 135],
         [108, 94, 133],
         [104, 84, 129],
         [106, 84, 131],
         [116, 86, 131],
         [108, 84, 129],
         [112, 95, 138],
         [112, 85, 131],
         [109, 90, 135]],

        [[125, 86, 129],
         [131, 90, 136],
         [114, 81, 124],
         [114, 82, 128],
         [117, 82, 128],
         [117, 82, 128],
         [113, 80, 124],
         [116, 85, 128],
         [123, 84, 130],
         [114, 81, 127],
         [123, 81, 127]],

        [[144, 84, 129],
         [137, 83, 128],
         [146, 84, 131],
         [159, 87, 133],
         [155, 89, 135],
         [155, 85, 132],
         [150, 83, 130],
         [147, 89, 132],
         [147, 86, 131],
         [128, 82, 126],
         [128, 82, 125],
         [137, 84, 129],
         [145, 85, 130]]],

    'bld': [
        [[174, 148, 93],
         [170, 144, 92],
         [169, 143, 91],
         [171, 146, 92],
         [173, 148, 95],
         [171, 145, 91],
         [170, 145, 91],
         [172, 146, 91],
         [174, 147, 92],
         [174, 147, 93], ],

        [[166, 142, 93],
         [169, 144, 92],
         [171, 147, 92],
         [170, 144, 90],
         [169, 145, 92],
         [169, 144, 91],
         [169, 143, 89],
         [168, 144, 90],
         [166, 142, 91],
         [167, 143, 94], ],

        [[167, 143, 88],
         [167, 143, 88],
         [166, 144, 90],
         [164, 143, 91],
         [161, 140, 90],
         [161, 140, 90],
         [164, 145, 94],
         [164, 141, 90],
         [161, 139, 89],
         [162, 141, 91],
         [164, 140, 90]],

        [[153, 134, 87],
         [150, 133, 89],
         [153, 135, 90],
         [153, 135, 90],
         [157, 136, 87],
         [155, 136, 89],
         [152, 135, 90],
         [156, 136, 90],
         [152, 136, 90],
         [150, 131, 86]],

        [[135, 126, 90],
         [136, 126, 89],
         [135, 126, 89],
         [132, 123, 90],
         [131, 124, 88],
         [130, 123, 89],
         [132, 121, 87],
         [135, 128, 88],
         [134, 127, 89],
         [135, 122, 86]],

        [[109, 113, 86],
         [112, 120, 93],
         [110, 116, 88],
         [109, 111, 86],
         [109, 110, 85],
         [112, 113, 85],
         [116, 114, 84],
         [113, 116, 88],
         [115, 119, 90],
         [115, 117, 90]],

        [[93, 102, 82],
         [90, 101, 84],
         [92, 102, 83],
         [89, 103, 85],
         [93, 102, 84],
         [89, 100, 83],
         [92, 102, 85],
         [90, 102, 85],
         [91, 102, 84],
         [94, 102, 85]],

        [[77, 94, 85],
         [78, 93, 85],
         [77, 90, 82],
         [78, 94, 87],
         [77, 91, 81],
         [76, 92, 82],
         [74, 92, 83],
         [79, 95, 88],
         [74, 92, 83]],

        [[69, 86, 82],
         [68, 86, 85],
         [68, 85, 80],
         [75, 86, 85],
         [68, 87, 84],
         [72, 87, 85],
         [67, 81, 83],
         [68, 81, 83],
         [68, 80, 83],
         [71, 89, 84],
         [73, 86, 83],
         [68, 83, 79],
         [71, 84, 81],
         [68, 86, 80],
         [70, 84, 81]],

        [[70, 83, 89],
         [65, 86, 89],
         [66, 86, 87],
         [71, 85, 92],
         [70, 88, 90],
         [68, 85, 84],
         [70, 87, 89],
         [70, 85, 89],
         [69, 83, 88],
         [70, 84, 89]]],

    'order': ['leu', 'bld', 'prot', 'ph', 'den'],

    "nullspace_cal": [
        [147, 221, 191],
        [81, 131, 152],
        [0, 99, 118],
        [250, 144, 102],
        [227, 195, 78],
        [0, 73, 132],
        [45, 80, 141],
        [236, 237, 241],
        [0, 117, 161],
        [180, 183, 183],
        [0, 104, 135],
        [93, 103, 118],
        [235, 238, 202],
        [0, 137, 113],
        [195, 191, 112],
        [0, 103, 152],
        [246, 147, 141],
        [168, 118, 163],
        [156, 78, 134],
        [209, 210, 214],
        [3, 98, 118],
        [139, 148, 153],
        [146, 110, 126],
        [55, 66, 81]
    ],

    "nullspace_eval": [
        [136, 154, 88],
        [222, 226, 189],
        [212, 187, 85],
        [199, 146, 151],
        [153, 92, 139],
        [63, 148, 140],
        [128, 158, 182],
        [134, 215, 181],
        [247, 144, 88],
        [134, 183, 128],
        [16, 87, 139],
        [0, 117, 154]
    ],
    "null_space": [
        [147, 221, 191],
        [81, 131, 152],
        [0, 99, 118],
        [250, 144, 102],
        [227, 195, 78],
        [0, 73, 132],
        [45, 80, 141],
        [236, 237, 241],
        [0, 117, 161],
        [180, 183, 183],
        [0, 104, 135],
        [93, 103, 118],
        [235, 238, 202],
        [0, 137, 113],
        [195, 191, 112],
        [0, 103, 152],
        [246, 147, 141],
        [168, 118, 163],
        [156, 78, 134],
        [209, 210, 214],
        [3, 98, 118],
        [139, 148, 153],
        [146, 110, 126],
        [55, 66, 81],
        [136, 154, 88],
        [222, 226, 189],
        [212, 187, 85],
        [199, 146, 151],
        [153, 92, 139],
        [63, 148, 140],
        [128, 158, 182],
        [134, 215, 181],
        [247, 144, 88],
        [134, 183, 128],
        [16, 87, 139],
        [0, 117, 154]
    ],

    'conc_leu': [0.0, 5.0, 9.0, 18.0, 37.0, 74.0, 148.0, 295.0, 591.0, 1181.0, 2363.0, 4725.0, 9450.0],
    'conc_ph': [5.0, 5.5, 6.0, 6.5, 7.0, 7.5, 8.0, 8.5],
    'conc_prot': [0.0, 0.1, 0.2, 0.3, 0.5, 1.0, 2.0, 3.0, 5.0],
    'conc_den': [0.0, 10.0, 20.0, 30.0, 40.0, 60.0, 80.0, 100.0, 120.0],
    'conc_bld': [0.0, 5.0, 12.5, 25.0, 50.0, 100.0, 200.0, 400.0, 800.0, 2000.0],

    "label_id": {
        1: "cal_1",
        2: "cal_10",
        3: "cal_11",
        4: "cal_12",
        5: "cal_13",
        6: "cal_14",
        7: "cal_15",
        8: "cal_16",
        9: "cal_17",
        10: "cal_18",
        11: "cal_19",
        12: "cal_2",
        13: "cal_20",
        14: "cal_21",
        15: "cal_22",
        16: "cal_23",
        17: "cal_24",
        18: "cal_3",
        19: "cal_4",
        20: "cal_5",
        21: "cal_6",
        22: "cal_7",
        23: "cal_8",
        24: "cal_9",
        25: "eval_1",
        26: "eval_10",
        27: "eval_11",
        28: "eval_12",
        29: "eval_2",
        30: "eval_3",
        31: "eval_4",
        32: "eval_5",
        33: "eval_6",
        34: "eval_7",
        35: "eval_8",
        36: "eval_9",
        37: "strip",
        38: "tooth_1",
        39: "tooth_2",
        40: "tooth_3",
        41: "tooth_4",
        42: "zone_1",
        43: "zone_2",
        44: "zone_3",
        45: "zone_4",
        46: "zone_5",
    },
}

from scipy.optimize import curve_fit


def func(x, a, b, c, a1, a2, a3, a4, a5):
    x_n = x[0] * a + x[1] * b + x[2] * c

    return (x_n ** 4) * a1 + (x_n ** 3) * a2 + (x_n ** 2) * a3 + x_n * a4 + a5


def opt(func, x, y):
    popt, pcov = curve_fit(func, x, y, maxfev=1000000)

    # print(popt)

    return popt, pcov


coefs = []

for key in conf_dict['order']:

    d = []

    c = []

    for i in range(len(conf_dict[key])):

        for el in conf_dict[key][i]:
            d.append(el)

            c.append(conf_dict['conc_' + str(key)][i])

    popt, pcov = opt(func, np.transpose(np.array(d)), np.array(c))

    coefs.append(popt.tolist())

conf_dict['coefs'] = coefs

json_dict = json.dumps(conf_dict)

with open(os.path.join(home, main_cnfg_pth), "w") as jp:
    json.dump(json_dict, jp)